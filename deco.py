"""
Декоратор readonly - робить функцію тільки для читання.
Автор: Степанюк Каріна

=== ЩО ТАКЕ АТРИБУТ? ===
Атрибут - це властивість (характеристика) об'єкта.

Приклад:
  Людина має атрибути: ім'я, вік, зріст
  Функція має атрибути: __name__ (ім'я), __doc__ (документація)

У цьому коді ми додаємо свій атрибут __readonly__ до функції,
щоб позначити, що вона не може бути перевизначена.

Приклад:
  def my_func():
      return 5
  
  my_func.custom = "Мій атрибут"  # Додаємо атрибут
  print(my_func.custom)           # Виведе: Мій атрибут
  print(hasattr(my_func, 'custom'))  # True - атрибут існує
"""

# Створюємо порожній словник для зберігання функцій, які позначені як readonly
# Словник - це структура даних: {ключ: значення}
# Приклад: {"suma": <function>, "pomnozh": <function>}
_readonly_functions = {}


def readonly(func):
    """
    Декоратор, що не дозволяє перевизначити функцію.
    
    Декоратор - це функція, яка змінює поведінку іншої функції.
    Синтаксис: @readonly перед функцією
    Це те саме, що: suma = readonly(suma)
    """
    
    # Створюємо функцію-обгортку (wrapper)
    # Вона буде викликатися ЗАМІСТЬ оригінальної функції
    # *args - збирає всі позиційні аргументи в кортеж
    #   Приклад: func(1, 2, 3) -> args = (1, 2, 3)
    # **kwargs - збирає всі іменовані аргументи в словник
    #   Приклад: func(a=1, b=2) -> kwargs = {'a': 1, 'b': 2}
    def wrapper(*args, **kwargs):
        # Викликаємо ОРИГІНАЛЬНУ функцію func з усіма аргументами
        # return - повертаємо результат назад
        return func(*args, **kwargs)
    
    # ДОДАЄМО АТРИБУТ до функції wrapper
    # wrapper.__readonly__ = True
    # Це як "наклейка" на функції, що вона readonly
    # __readonly__ - це просто ім'я атрибута (можна назвати як завгодно)
    # True - значення атрибута (булеве значення: True або False)
    wrapper.__readonly__ = True
    
    # Копіюємо ім'я оригінальної функції
    # func.__name__ - це вбудований атрибут, який зберігає ім'я функції
    # Якщо функція називається suma, то func.__name__ = "suma"
    # Ми копіюємо це ім'я в wrapper, щоб не втратити його
    wrapper.__name__ = func.__name__
    
    # Зберігаємо функцію в словник
    # _readonly_functions["suma"] = wrapper
    # Тепер ми можемо знайти цю функцію за її іменем
    _readonly_functions[func.__name__] = wrapper
    
    # Повертаємо обгортку ЗАМІСТЬ оригінальної функції
    # Тепер коли викличуть suma(), насправді викличеться wrapper()
    return wrapper


def check_readonly(name, new_value):
    """
    Перевіряє, чи функція readonly перед перевизначенням.
    
    Параметри:
      name - ім'я функції (рядок), наприклад "suma"
      new_value - нове значення, яким хочуть замінити функцію
    """
    
    # Перевіряємо, чи є ім'я функції в словнику readonly функцій
    # Оператор 'in' перевіряє, чи є ключ в словнику
    # Приклад: "suma" in {"suma": func, "pomnozh": func} -> True
    if name in _readonly_functions:
        
        # hasattr(об'єкт, 'ім'я_атрибута') - перевіряє наявність атрибута
        # Повертає True, якщо атрибут є, False - якщо немає
        # Приклад: hasattr(suma, '__readonly__') -> True
        if hasattr(_readonly_functions[name], '__readonly__'):
            
            # === ЩО ТАКЕ ВИКЛЮЧЕННЯ (EXCEPTION)? ===
            # Виключення - це помилка, яка зупиняє виконання програми
            # 
            # raise - ключове слово для СТВОРЕННЯ (викидання) помилки
            # AttributeError - ТИП помилки (про атрибути)
            #
            # ТИПИ ПОМИЛОК в Python:
            #   - AttributeError - помилка з атрибутом
            #   - ValueError - неправильне значення
            #   - TypeError - неправильний тип даних
            #   - KeyError - немає такого ключа в словнику
            #   - IndexError - індекс за межами списку
            #   - ZeroDivisionError - ділення на нуль
            #   - FileNotFoundError - файл не знайдено
            #
            # f"текст {змінна}" - це f-рядок (formatted string)
            # Він дозволяє вставляти значення змінних в текст
            # Приклад: name = "suma"
            #          f"Функція '{name}'" -> "Функція 'suma'"
            raise AttributeError(
                f"Помилка! Функція '{name}' є readonly і не може бути перевизначена!"
            )
